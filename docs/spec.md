# Ding

## 目的

このプロジェクトは、カジュアル面談の前後情報を LLM とのチャットで構造化し、
応募者・面接官の入力体験を改善するハッカソン向け PoC。

## 前提

- 本 PoC は「自動評価」や「自動採否判定」を行わない
- LLM は「質問生成」と「入力内容の整理」を支援する
- 最終判断は人間が行う

## 何をするか

### 1. LLM との会話で応募フォームを埋める

- 応募者はフォームに直接入力せず、LLM とのチャットで回答する
- 企業側は募集作成時に、フォーム項目と深掘りしたい観点を設定する
- LLM は人材要件に沿って質問の焦点を合わせ、回答を構造化してフォームへ反映する

### 2. 面談後の所感を LLM チャットで構造化する

- 面談後、面接官は LLM との対話で所感を入力する
- LLM は理想人物像に沿った質問を行い、回答を構造化して保存する
- 目的は「情報の抜け漏れを減らすこと」であり、スコアリングではない

## MVP 要件（ハッカソン）

### 求人作成

- 求人を作成できる
- 求人ごとに応募フォーム項目を定義できる
- 求人ごとに深掘り観点（intent）を設定できる
- 求人ごとに理想人物像を設定できる
- 求人ごとにカルチャー背景を設定できる（企業の働き方・価値観を箇条書きで入力）

### 応募フロー

- 求人ごとに応募チャットを開始できる
- チャット開始時に `言語` と `居住国` を取得する
- タイムゾーンは自動推定し、手動修正できる
- LLM が理想人物像に沿って質問を生成する
- チャット内容からフォーム項目を抽出する
- 応募前に抽出結果の確認・修正ステップを設ける（必須）
- 応募前に同意チェックを設ける（必須）
- 応募者一覧と応募詳細を閲覧できる
- 面談用に Google Meet リンクを表示する（PoC）
- ステータスを管理できる（`新規` `日程調整中` `面談済み` `クローズ`）

### 面談後フロー

- 面談後のヒアリングチャットを開始できる
- LLM が理想人物像に沿った質問を行う
- 面接官回答を構造化して保存できる

## 必須フロー（応募時）

1. チャットで回答
2. 抽出結果の確認・修正
3. 同意チェック
4. 応募確定

## 応募エージェント思考フロー

### 全体フロー

1. 運営が求人を作成し、フォーム項目・intent・理想人物像・カルチャー背景を設定する
2. 設定内容をもとに LLM がフィールド定義（required_facts / done_criteria）を自動生成する
3. 運営が生成結果を確認・微修正し、応募を Open にする
4. 応募者がチャットを開始する
5. セッション開始処理（session_bootstrap）で言語・居住国を取得し、タイムゾーンを推定する
6. エージェントが質問プランを Todo 化し、会話を進める
7. 全 Todo 完了後、抽出結果の確認・修正 → 同意チェック → 応募確定

### フィールド定義

運営が設定する項目：

- `field_id`: フィールド識別子
- `label`: 表示名
- `intent`: 深掘り観点（何を見たいか）
- `required`: 必須かどうか

LLM が自動生成する項目（運営が微修正可能）：

- `required_facts`: 収集すべき事実のリスト（1 fact = 1 Todo）
- `done_criteria`: 各 fact の完了条件
- `prohibited_topics`: 聞いてはいけない話題

#### 自動生成のインプット

生成時の情報優先順位：

1. `intent`（何を見たいか）
2. `culture_context`（企業の働き方・価値観）
3. `ideal_candidate`（理想人物像、補助情報）
4. `job_title`（求人タイトル、文脈情報）

#### 自動生成の例

```
フィールド: 志望動機
intent: カルチャーフィットを見たい
culture_context: フルリモート / 非同期中心 / 意思決定が速い

→ required_facts:
  - 非同期コミュニケーションで成果を出した実例
  - 不確実な状況下での意思決定スタイル
  - 技術的チャレンジへの自走経験
→ done_criteria:
  - 直近の具体事例、本人の行動、結果が確認できること
→ prohibited_topics:
  - 前職の機密情報
```

### セッション開始（session_bootstrap）

チャット開始時に以下を取得する。これを通過しないと質問ループに入れない。

1. `言語` を取得する
2. `居住国` を取得する
3. `タイムゾーン` を自動推定し、手動修正できるようにする
4. データ利用説明を表示する

### Todo 状態遷移

各 required_fact に対して Todo を1つ作成し、以下の状態で管理する。

#### ステータス定義

- `pending`: 未着手
- `awaiting_answer`: 質問送信済み、回答待ち
- `validating`: 回答を受信し、抽出・検証中
- `needs_clarification`: 回答が曖昧で追加質問が必要
- `done`: 完了条件を満たした
- `manual_input`: フォールバックにより手入力に切り替え

#### 状態遷移

```
pending → awaiting_answer（質問送信時）
awaiting_answer → validating（回答受信時）
validating → done（抽出成功、done_criteria 充足時）
validating → needs_clarification（回答が曖昧な場合）
needs_clarification → awaiting_answer（追加質問送信時）
任意の状態 → manual_input（フォールバック閾値到達時）
manual_input → done（手入力完了時）
done → pending（ユーザーが確認画面で修正した場合）
```

#### 不変条件

- `required` な Todo がすべて `done` でなければ応募確定できない

### 質問生成と会話設計

#### 基本ルール

- 1 質問 1 目的（各質問は必ず 1 つの field_id と intent に紐づく）
- 回答から複数 fact を抽出して一括更新する（1fact-1question の厳密な縛りではない）
- 応募者が話題を飛ばして自由に話した場合も、該当する fact があれば抽出・更新する
- 既回答済みの事実を再質問しない

#### 質問優先度

未充足の fact を以下の優先度で選択する：

1. `required` フラグが付いた fact を優先
2. 理想人物像（ideal_candidate）との関連度が高い fact を加点

#### 会話トーン設計

- 最初の挨拶: 自己紹介と会話の目的を伝える
- 質問中: 丁寧で中立な聞き方。命令口調・圧迫・断定は禁止
- 相槌: 回答への受容を示してから次の質問に移る
- 締め: 感謝を伝え、確認画面への誘導を行う

### ガードレール

#### 目的適合

- 各質問は必ず 1 つの `field_id` と `intent` に紐づく
- 紐づかない質問は生成しない

#### 禁止トピック

- 年齢、家族計画、宗教、思想、健康情報など、採用判断に不要なセンシティブ情報は禁止
- フィールド単位の `prohibited_topics` でも制御する

#### 最小取得

- 判断に不要な個人情報は聞かない
- 範囲・経験・状況を先に聞き、詳細特定情報は避ける

### レビュー体制

#### 軽量レビュー（毎ターン実施）

ルールベースで以下を判定する：

- `field_id` / `intent` への紐づきがあるか
- 禁止トピックに該当しないか
- 既回答の fact を再質問していないか
- トーン違反がないか

#### 重レビュー（最終送信前のみ実施）

LLM による会話履歴全体の精査：

- 過剰な情報収集がないか
- 失礼な表現がないか
- 会話全体の一貫性

### フォールバック

#### 条件（いずれかを満たした場合）

- レビュー失敗が 3 回連続
- 抽出失敗が 2 回連続
- タイムアウトが 2 回連続

#### 動作

1. 未入力のフォーム項目を一覧表示する
2. 応募者に手入力してもらう
3. 入力完了後、確認・同意ステップに進む
4. `manual_fallback_triggered` イベントを記録する

### イベント計測

- `chat_started`: チャット開始
- `session_bootstrap_completed`: セッション開始処理完了
- `extraction_reviewed`: 抽出結果の確認完了
- `consent_checked`: 同意チェック完了
- `application_submitted`: 応募確定
- `manual_fallback_triggered`: 手入力フォールバック発動

## データ保護（PoC 最小要件）

- 取得データを明示する（例: 氏名、連絡先、会話ログ）
- 利用目的を明示する
- 保存期間を明示する（例: 90 日）
- 削除依頼の窓口を用意する
- 同意取得ログを保存する
- アクセス権限を分ける（必要な人のみ閲覧可能）

## 今回やらないこと（スコープ外）

- 自動採否判定
- 候補者スコアリング
- 高度な ATS 連携
- 面接官評価の自動集計

## 成功指標（MVP）

- 応募完了率
- 応募完了までの平均時間
- 面談後フィードバック入力完了率
- 抽出結果の修正率（LLM 抽出品質の確認）

## 優先度付きロードマップ（ハッカソン）

### P0（最優先: デモ成立に必須）

- 応募時の必須フローを end-to-end で完成させる
  - `チャット回答 -> 抽出結果の確認・修正 -> 同意チェック -> 応募確定`
- 求人作成の最小機能を実装する
  - 求人作成、フォーム項目定義、深掘り観点、理想人物像、カルチャー背景の設定
  - フィールド定義の自動生成（required_facts / done_criteria）
- 応募一覧/応募詳細の最小閲覧機能を実装する
- LLM 失敗時のフォールバックを実装する
  - 質問生成や抽出に失敗した場合でも、手入力で応募完了できる
- 同意ログを保存する（いつ、誰が、何に同意したか）
- 最小イベント計測を実装する
  - `chat_started` `extraction_reviewed` `consent_checked` `application_submitted`

### P1（優先: 体験品質を上げる）

- ステータス管理を実装する（`新規` `日程調整中` `面談済み` `クローズ`）
- Google Meet リンク表示を実装する（PoC）
- 面談後ヒアリングチャットを実装する
  - 面接官の回答を構造化して保存する
- データ保護要件の運用補強を行う
  - 削除依頼の受付導線
  - 閲覧権限の分離（必要な人のみ）

### P2（拡張: 次フェーズ）

- 多言語対応の改善（原文保存 + 表示言語の切替）
- 監査ログ/運用ログを強化する（誰がいつ閲覧・更新したか）
- KPI を拡張する
  - 項目欠落率、再入力率、面談後メモの網羅率
- ATS など外部連携の検討を開始する

### 実装順（推奨）

1. データモデルと API（求人/応募/同意ログ/応募ステータス）
2. 応募フロー UI（必須フローを最短で通す）
3. LLM 連携（質問生成・抽出・確認修正）
4. フォールバックと計測（失敗時手入力、主要イベント）
5. 面談後フローと運用補強（P1）
